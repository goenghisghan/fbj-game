{% extends "base.html" %}{% block content %}
<h2>League Table</h2>
<table class="table table-league">
  <thead><tr><th>Rank</th><th>Manager</th><th>League Pts</th><th>Avg GW Pts</th></tr></thead>
  <tbody>
  {% for row in league_rows %}
    <tr>
      <td>{{ loop.index }}</td>
      <td>{{ row.username }}</td>
      <td>{{ row.total_lp }}</td>
      <td>{{ "%.1f"|format(row.avg_gw) }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<h3 style="margin-top:24px">Gameweek History</h3>
<form method="GET" style="margin-bottom:10px">
  <label>Gameweek:
    <select name="gw" onchange="this.form.submit()">
      {% for ev in all_gws %}
        <option value="{{ ev.id }}" {% if ev.id == selected_gw %}selected{% endif %}>GW {{ ev.id }}</option>
      {% endfor %}
    </select>
  </label>
  {% if can_finalize %}
    <button class="btn btn-secondary" formaction="{{ url_for('finalize_gw') }}" formmethod="post">Finalize This GW</button>
  {% endif %}
</form>
<table class="table">
  <thead><tr><th>Manager</th><th>GW Points</th><th>League Points</th></tr></thead>
  <tbody>
  {% for r in history_rows %}
    <tr>
      <td>{{ r.username }}</td>
      <td>{{ r.display_points }}</td>
      <td>{{ r.league_points }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const badges = document.querySelectorAll(".badge");
  const total = badges.length;
  
  badges.forEach(badge => {
    const rank = parseInt(badge.dataset.rank, 10);
    const hue = 120 - ((rank - 1) / (total - 1)) * 120;
    badge.style.backgroundColor = `hsl(${hue}, 80%, 40%)`;
  });
});
</script>
{% endblock %}